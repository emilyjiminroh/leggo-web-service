<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" />

    <title>RoadMap</title>
    <style>
      #container {
        overflow: hidden;
        height: 300px;
        position: relative;
      }
      #mapWrapper {
        width: 100%;
        height: 300px;
        z-index: 1;
      }
      #rvWrapper {
        width: 50%;
        height: 300px;
        top: 0;
        right: 0;
        position: absolute;
        z-index: 0;
      }
      #container.view_roadview #mapWrapper {
        width: 50%;
      }
      #roadviewControl {
        position: absolute;
        top: 5px;
        left: 5px;
        width: 42px;
        height: 42px;
        z-index: 1;
        cursor: pointer;
        background: url(https://t1.daumcdn.net/localimg/localimages/07/2018/pc/common/img_search.png)
          0 -450px no-repeat;
      }
      #roadviewControl.active {
        background-position: 0 -350px;
      }
      #close {
        position: absolute;
        padding: 4px;
        top: 5px;
        left: 5px;
        cursor: pointer;
        background: #fff;
        border-radius: 4px;
        border: 1px solid #c8c8c8;
        box-shadow: 0px 1px #888;
      }
      #close .img {
        display: block;
        background: url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/rv_close.png)
          no-repeat;
        width: 14px;
        height: 14px;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="title_box">
        <img class="title title_img" src="img/leggo_logo.jpg" />
        <h1 class="title title_font">ë¡œë“œë§µğŸ›´</h1>
      </div>
    </header>
    <nav class="menu">
      <a href="/howtogo"><span class="nav_type">ê¸¸ì°¾ê¸°ğŸš©</span></a>
      <a href="/ground"><span class="nav_type">ê´‘ì§„êµ¬ ëœë“œë§ˆí¬ğŸˆ</span></a>
      <a href="/traffic"><span class="nav_type">ê´‘ì§„êµ¬ ë¡œë“œë§µğŸ›´</span></a>
      <a href="/service"><span class="nav_type">ê´‘ì§„êµ¬ ì†Œì‹í†µğŸ“¢</span></a>
      <a href="/"><span class="nav_type">ë©”ì¸ë©”ë‰´ë¡œğŸ“‚</span></a>
    </nav>
    <h2>ê°€ì•¼í•  ê¸¸ì„ ë¯¸ë¦¬ ë³´ê³  ì•ˆì „í•˜ê²Œ ê°€ì„¸ìš”ğŸŒ¿</h2>
    <div id="container">
      <div id="rvWrapper">
        <div id="roadview" style="width: 90%; height: 100%"></div>
        <!-- ë¡œë“œë·°ë¥¼ í‘œì‹œí•  div ì…ë‹ˆë‹¤ -->
        <div id="close" title="ë¡œë“œë·°ë‹«ê¸°" onclick="closeRoadview()">
          <span class="img"></span>
        </div>
      </div>

      <div id="mapWrapper">
        <div id="map" style="width: 100%; height: 100%"></div>
        <!-- ì§€ë„ë¥¼ í‘œì‹œí•  div ì…ë‹ˆë‹¤ -->
        <div id="roadviewControl" onclick="setRoadviewRoad()"></div>
      </div>
    </div>
    <div>
      <h3>
        ì™¼ìª½ ìƒë‹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¡œë“œë·°ë¥¼ í™•ì¸í•˜ì„¸ìš”! <br />
        ë³´ê³  ì‹¶ì€ ê²½ë¡œë¡œ ìº ì„ ë“œë˜ê·¸í•´ì„œ ì›€ì§ì´ë©´ í•´ë‹¹ ê²½ë¡œë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
      </h3>
    </div>

    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8c9626a684ab7368231bf0b48c304d75"
    ></script>
    <script>
      var overlayOn = false, // ì§€ë„ ìœ„ì— ë¡œë“œë·° ì˜¤ë²„ë ˆì´ê°€ ì¶”ê°€ëœ ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆì„ ë³€ìˆ˜
        container = document.getElementById("container"), // ì§€ë„ì™€ ë¡œë“œë·°ë¥¼ ê°ì‹¸ê³  ìˆëŠ” div ì…ë‹ˆë‹¤
        mapWrapper = document.getElementById("mapWrapper"), // ì§€ë„ë¥¼ ê°ì‹¸ê³  ìˆëŠ” div ì…ë‹ˆë‹¤
        mapContainer = document.getElementById("map"), // ì§€ë„ë¥¼ í‘œì‹œí•  div ì…ë‹ˆë‹¤
        rvContainer = document.getElementById("roadview"); //ë¡œë“œë·°ë¥¼ í‘œì‹œí•  div ì…ë‹ˆë‹¤

      var mapCenter = new kakao.maps.LatLng(37.54909, 127.075131), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
        mapOption = {
          center: mapCenter, // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
          level: 5, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };

      // ì§€ë„ë¥¼ í‘œì‹œí•  divì™€ ì§€ë„ ì˜µì…˜ìœ¼ë¡œ ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var map = new kakao.maps.Map(mapContainer, mapOption);

      // ë¡œë“œë·° ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var rv = new kakao.maps.Roadview(rvContainer);

      // ì¢Œí‘œë¡œë¶€í„° ë¡œë“œë·° íŒŒë…¸ë¼ë§ˆ IDë¥¼ ê°€ì ¸ì˜¬ ë¡œë“œë·° í´ë¼ì´ì–¸íŠ¸ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var rvClient = new kakao.maps.RoadviewClient();

      // ë¡œë“œë·°ì— ì¢Œí‘œê°€ ë°”ë€Œì—ˆì„ ë•Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
      kakao.maps.event.addListener(rv, "position_changed", function () {
        // í˜„ì¬ ë¡œë“œë·°ì˜ ìœ„ì¹˜ ì¢Œí‘œë¥¼ ì–»ì–´ì˜µë‹ˆë‹¤
        var rvPosition = rv.getPosition();

        // ì§€ë„ì˜ ì¤‘ì‹¬ì„ í˜„ì¬ ë¡œë“œë·°ì˜ ìœ„ì¹˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
        map.setCenter(rvPosition);

        // ì§€ë„ ìœ„ì— ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ê°€ ì¶”ê°€ëœ ìƒíƒœì´ë©´
        if (overlayOn) {
          // ë§ˆì»¤ì˜ ìœ„ì¹˜ë¥¼ í˜„ì¬ ë¡œë“œë·°ì˜ ìœ„ì¹˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
          marker.setPosition(rvPosition);
        }
      });

      // ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var markImage = new kakao.maps.MarkerImage(
        "https://t1.daumcdn.net/localimg/localimages/07/2018/pc/roadview_minimap_wk_2018.png",
        new kakao.maps.Size(26, 46),
        {
          // ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
          // ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ ì „ì²´ì˜ í¬ê¸°ë¥¼ ì§€ì •í•˜ê³ 
          spriteSize: new kakao.maps.Size(1666, 168),
          // ì‚¬ìš©í•˜ê³  ì‹¶ì€ ì˜ì—­ì˜ ì¢Œìƒë‹¨ ì¢Œí‘œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
          // background-positionìœ¼ë¡œ ì§€ì •í•˜ëŠ” ê°’ì´ë©° ë¶€í˜¸ëŠ” ë°˜ëŒ€ì…ë‹ˆë‹¤.
          spriteOrigin: new kakao.maps.Point(705, 114),
          offset: new kakao.maps.Point(13, 46),
        }
      );

      // ë“œë˜ê·¸ê°€ ê°€ëŠ¥í•œ ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var marker = new kakao.maps.Marker({
        image: markImage,
        position: mapCenter,
        draggable: true,
      });

      // ë§ˆì»¤ì— dragend ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
      kakao.maps.event.addListener(marker, "dragend", function (mouseEvent) {
        // í˜„ì¬ ë§ˆì»¤ê°€ ë†“ì¸ ìë¦¬ì˜ ì¢Œí‘œì…ë‹ˆë‹¤
        var position = marker.getPosition();

        // ë§ˆì»¤ê°€ ë†“ì¸ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¡œë“œë·°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
        toggleRoadview(position);
      });

      //ì§€ë„ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
      kakao.maps.event.addListener(map, "click", function (mouseEvent) {
        // ì§€ë„ ìœ„ì— ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ê°€ ì¶”ê°€ëœ ìƒíƒœê°€ ì•„ë‹ˆë©´ í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•©ë‹ˆë‹¤
        if (!overlayOn) {
          return;
        }

        // í´ë¦­í•œ ìœ„ì¹˜ì˜ ì¢Œí‘œì…ë‹ˆë‹¤
        var position = mouseEvent.latLng;

        // ë§ˆì»¤ë¥¼ í´ë¦­í•œ ìœ„ì¹˜ë¡œ ì˜®ê¹ë‹ˆë‹¤
        marker.setPosition(position);

        // í´ë½í•œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¡œë“œë·°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
        toggleRoadview(position);
      });

      // ì „ë‹¬ë°›ì€ ì¢Œí‘œ(position)ì— ê°€ê¹Œìš´ ë¡œë“œë·°ì˜ íŒŒë…¸ë¼ë§ˆ IDë¥¼ ì¶”ì¶œí•˜ì—¬
      // ë¡œë“œë·°ë¥¼ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
      function toggleRoadview(position) {
        rvClient.getNearestPanoId(position, 50, function (panoId) {
          // íŒŒë…¸ë¼ë§ˆ IDê°€ null ì´ë©´ ë¡œë“œë·°ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤
          if (panoId === null) {
            toggleMapWrapper(true, position);
          } else {
            toggleMapWrapper(false, position);

            // panoIdë¡œ ë¡œë“œë·°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
            rv.setPanoId(panoId, position);
          }
        });
      }

      // ì§€ë„ë¥¼ ê°ì‹¸ê³  ìˆëŠ” divì˜ í¬ê¸°ë¥¼ ì¡°ì •í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
      function toggleMapWrapper(active, position) {
        if (active) {
          // ì§€ë„ë¥¼ ê°ì‹¸ê³  ìˆëŠ” divì˜ ë„ˆë¹„ê°€ 100%ê°€ ë˜ë„ë¡ classë¥¼ ë³€ê²½í•©ë‹ˆë‹¤
          container.className = "";

          // ì§€ë„ì˜ í¬ê¸°ê°€ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— relayout í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤
          map.relayout();

          // ì§€ë„ì˜ ë„ˆë¹„ê°€ ë³€ê²½ë  ë•Œ ì§€ë„ì¤‘ì‹¬ì„ ì…ë ¥ë°›ì€ ìœ„ì¹˜(position)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
          map.setCenter(position);
        } else {
          // ì§€ë„ë§Œ ë³´ì—¬ì§€ê³  ìˆëŠ” ìƒíƒœì´ë©´ ì§€ë„ì˜ ë„ˆë¹„ê°€ 50%ê°€ ë˜ë„ë¡ classë¥¼ ë³€ê²½í•˜ì—¬
          // ë¡œë“œë·°ê°€ í•¨ê»˜ í‘œì‹œë˜ê²Œ í•©ë‹ˆë‹¤
          if (container.className.indexOf("view_roadview") === -1) {
            container.className = "view_roadview";

            // ì§€ë„ì˜ í¬ê¸°ê°€ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— relayout í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤
            map.relayout();

            // ì§€ë„ì˜ ë„ˆë¹„ê°€ ë³€ê²½ë  ë•Œ ì§€ë„ì¤‘ì‹¬ì„ ì…ë ¥ë°›ì€ ìœ„ì¹˜(position)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
            map.setCenter(position);
          }
        }
      }

      // ì§€ë„ ìœ„ì˜ ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ë¥¼ ì¶”ê°€,ì œê±°í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
      function toggleOverlay(active) {
        if (active) {
          overlayOn = true;

          // ì§€ë„ ìœ„ì— ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
          map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);

          // ì§€ë„ ìœ„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
          marker.setMap(map);

          // ë§ˆì»¤ì˜ ìœ„ì¹˜ë¥¼ ì§€ë„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
          marker.setPosition(map.getCenter());

          // ë¡œë“œë·°ì˜ ìœ„ì¹˜ë¥¼ ì§€ë„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤
          toggleRoadview(map.getCenter());
        } else {
          overlayOn = false;

          // ì§€ë„ ìœ„ì˜ ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ë¥¼ ì œê±°í•©ë‹ˆë‹¤
          map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);

          // ì§€ë„ ìœ„ì˜ ë§ˆì»¤ë¥¼ ì œê±°í•©ë‹ˆë‹¤
          marker.setMap(null);
        }
      }

      // ì§€ë„ ìœ„ì˜ ë¡œë“œë·° ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
      function setRoadviewRoad() {
        var control = document.getElementById("roadviewControl");

        // ë²„íŠ¼ì´ ëˆŒë¦° ìƒíƒœê°€ ì•„ë‹ˆë©´
        if (control.className.indexOf("active") === -1) {
          control.className = "active";

          // ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ê°€ ë³´ì´ê²Œ í•©ë‹ˆë‹¤
          toggleOverlay(true);
        } else {
          control.className = "";

          // ë¡œë“œë·° ë„ë¡œ ì˜¤ë²„ë ˆì´ë¥¼ ì œê±°í•©ë‹ˆë‹¤
          toggleOverlay(false);
        }
      }

      // ë¡œë“œë·°ì—ì„œ Xë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë¡œë“œë·°ë¥¼ ì§€ë„ ë’¤ë¡œ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
      function closeRoadview() {
        var position = marker.getPosition();
        toggleMapWrapper(true, position);
      }

      var mapTypeControl = new kakao.maps.MapTypeControl();

      // ì§€ë„ì— ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•´ì•¼ ì§€ë„ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
      // kakao.maps.ControlPositionì€ ì»¨íŠ¸ë¡¤ì´ í‘œì‹œë  ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ”ë° TOPRIGHTëŠ” ì˜¤ë¥¸ìª½ ìœ„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤
      map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

      // ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
      var zoomControl = new kakao.maps.ZoomControl();
      map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
    </script>
  </body>
</html>
